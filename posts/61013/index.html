<!DOCTYPE html>
<html lang="zh-tw" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="Game,Unity,Programming" />
  <meta name="author" content="PeDev" />
  <meta name="description" content="介紹一下優秀 2D 平台跳躍遊戲的角色控制會用到的一些通用知識，主要都是整理自網路上的學習資源和我實際在 Bionic Bay 上的應用。">
<meta property="og:type" content="article">
<meta property="og:title" content="做好 2D 平台跳躍遊戲，從角色控制開始 _BB001">
<meta property="og:url" content="https://qwe321qwe321qwe321.github.io/posts/61013/">
<meta property="og:site_name" content="PE工具箱">
<meta property="og:description" content="介紹一下優秀 2D 平台跳躍遊戲的角色控制會用到的一些通用知識，主要都是整理自網路上的學習資源和我實際在 Bionic Bay 上的應用。">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/01.png">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/platformer_toolkit_1.gif">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/horizontal_movement_2.png">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/2023-07-23T000611.png">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/horizontal_movement_castle.gif">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/2023-07-23T000715.png">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/horizontal_movement_smb.gif">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/2023-07-23T000735.png">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/horizontal_movement_mario.gif">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/2023-07-23T000803.png">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/horizontal_movement_limbo.gif">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/2023-07-23T002243.png">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/super_meat_boy_1.gif">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/super_meat_boy_2.gif">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/2023-07-23T002341.png">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/jump_var_1.gif">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/2023-07-23T004744.png">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/down_gravity_1.gif">
<meta property="og:image" content="https://miro.medium.com/v2/resize:fit:640/1*70K9UUcWBHmvfHFpaY4v1w.gif">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/2023-07-23T011340.png">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/2023-07-23T011614.png">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/2023-07-23T012508.png">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/2023-07-23T012835.png">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/2023-07-23T013515.png">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/2023-07-23T015404.png">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/variable_jump_1.gif">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/2023-07-23T020231.png">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/2023-07-23T021324.png">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/2023-07-23T022237.png">
<meta property="og:image" content="https://miro.medium.com/v2/resize:fit:640/1*j8PBeydkE6_vaytVHFcZ6Q.gif">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/jump_buffering_1.gif">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/jump_buffering_2.gif">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/2023-07-23T120748.png">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/2023-07-23T120844.png">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/hitbox_pinch_1.gif">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/hitbox_pinch_2.gif">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/hitbox_pinch_3.gif">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/hitbox_pinch_4.gif">
<meta property="og:image" content="https://miro.medium.com/v2/resize:fit:640/1*g5DWQoaPgADy2YJSadME9Q.gif">
<meta property="og:image" content="https://miro.medium.com/v2/resize:fit:640/1*wd8jSIbd7BCaltCWhOIxcw.gif">
<meta property="og:image" content="https://miro.medium.com/v2/resize:fit:640/1*cCX7zCuPXb7KFSpZXIy7VA.gif">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/hitbox_pinch_5.gif">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/hitbox_pinch_6.gif">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/hitbox_pinch_7.gif">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/ledge_tolerance_1.gif">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/ledge_tolerance_2.gif">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/ledge_tolerance_3.gif">
<meta property="og:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/ledge_tolerance_4.gif">
<meta property="article:published_time" content="2023-07-22T09:54:57.898Z">
<meta property="article:modified_time" content="2023-07-22T09:54:57.898Z">
<meta property="article:author" content="PeDev">
<meta property="article:tag" content="Bionic Bay">
<meta property="article:tag" content="Gamedev">
<meta property="article:tag" content="Unity">
<meta property="article:tag" content="Physics">
<meta property="article:tag" content="BB-devlog">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://qwe321qwe321qwe321.github.io/images/bb-001-character-controller/01.png">
<meta name="twitter:site" content="@qwe321qwe321qwe321">

  
  
  <title>做好 2D 平台跳躍遊戲，從角色控制開始 _BB001 | PE工具箱</title><meta name="robots" content="noindex">

  
    <link rel="apple-touch-icon" href="/melody-favicon.ico">
    <link rel="icon" href="/melody-favicon.ico">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  
<link rel="stylesheet" href="/css/color-scheme.css">
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/iconfont/iconfont.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/comments.css">
<link rel="stylesheet" href="/css/pedev-ext.css">


  <!-- jquery3.3.1 -->
  <script src="/js/jquery.min.js"></script>

  <!-- fancybox -->
  <link href="/css/jquery.fancybox.min.css" rel="stylesheet">
  <script async src="/js/jquery.fancybox.min.js"></script>
  
<script src="/js/fancybox.js"></script>


  
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JEC82CJEXT"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-JEC82CJEXT');
    </script>
  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>
  <!-- prism.css -->
  <link rel="stylesheet" href="/js/prism/prism.css">
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="PE工具箱" type="application/atom+xml">
</head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img src="/images/profile/avatar.gif" alt="">
      
    </a>
    <div class="nickname"><a href="/">PeDev</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">Tags</a>
        </li>
      
        <li class="nav-item" data-path="/portfolio/">
          <a href="/portfolio/">Portfolio</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->

<!-- LaTex Display -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  }
};
</script>





  

  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title"><i>(Hidden Post)</i> 做好 2D 平台跳躍遊戲，從角色控制開始 _BB001 </div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime" title="Update time"></i>
          2023-07-22 17:54:57
        </span>
        
              <span class="post-tags">
                <i class="iconfont icon-tags" title="Tags"></i>
                
                <span class="span--tag">
                  <a href="/tags/Bionic-Bay/" title="Bionic Bay">
                    <b>#</b> Bionic Bay
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/Gamedev/" title="Gamedev">
                    <b>#</b> Gamedev
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/Unity/" title="Unity">
                    <b>#</b> Unity
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/Physics/" title="Physics">
                    <b>#</b> Physics
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/BB-devlog/" title="BB-devlog">
                    <b>#</b> BB-devlog
                  </a>
                </span>
                
              </span>
          
        <div style="margin-top: 10px">
        <span class="post-wordcount"><i class="iconfont icon-eye"></i> 6.1k words / 21-minute read</span>
        </div>
      </div>
      
<div class="post-toc-body markdown-body">
    <details>
        <summary>目錄</summary>
        <div class="post-toc">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%89%8D%E8%A8%80"><span class="post-toc-text"> 前言</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%8F%AA%E6%98%AF%E5%80%8B-2d-%E9%81%8A%E6%88%B2%E7%9A%84%E8%A7%92%E8%89%B2%E6%8E%A7%E5%88%B6%E6%98%AF%E8%83%BD%E5%A4%9A%E8%A4%87%E9%9B%9C"><span class="post-toc-text"> 只是個 2D 遊戲的角色控制是能多複雜？</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E7%A7%BB%E5%8B%95%E8%88%87%E8%B7%B3%E8%BA%8D%E6%98%AF%E8%83%BD%E6%9C%89%E5%A4%9A%E8%A4%87%E9%9B%9C"><span class="post-toc-text"> 移動與跳躍？是能有多複雜？</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#1-%E6%B0%B4%E5%B9%B3%E7%A7%BB%E5%8B%95%E7%9A%84%E9%80%9F%E5%BA%A6%E5%8F%83%E6%95%B8"><span class="post-toc-text"> 1. 水平移動的速度參數</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%B9%BE%E6%AC%BE%E7%B6%93%E5%85%B8%E6%A9%AB%E5%90%91%E9%81%8A%E6%88%B2%E7%9A%84%E5%8F%83%E6%95%B8"><span class="post-toc-text"> 幾款經典橫向遊戲的參數</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#castlevania-%E6%83%A1%E9%AD%94%E5%9F%8E"><span class="post-toc-text"> Castlevania 惡魔城</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#super-meat-boy"><span class="post-toc-text"> Super Meat Boy</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#super-mario-bros-%E8%B6%85%E7%B4%9A%E7%91%AA%E5%88%A9%E6%AD%90%E5%85%84%E5%BC%9F"><span class="post-toc-text"> Super Mario Bros 超級瑪利歐兄弟</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#limbo"><span class="post-toc-text"> LIMBO</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E8%BD%89%E5%90%91%E5%8A%A0%E9%80%9F%E5%BA%A6turn-acceleration"><span class="post-toc-text"> 轉向加速度（Turn Acceleration）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%95%B8%E5%80%BC%E8%A1%A8%E6%A0%BC"><span class="post-toc-text"> 數值表格</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#2-%E8%B7%B3%E8%BA%8D%E9%80%9F%E5%BA%A6-%E9%AB%98%E5%BA%A6%E8%88%87%E9%87%8D%E5%8A%9Bgravity"><span class="post-toc-text"> 2. 跳躍速度、高度與重力（Gravity）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%B9%BE%E6%AC%BE%E7%B6%93%E5%85%B8%E6%A9%AB%E5%90%91%E9%81%8A%E6%88%B2%E7%9A%84%E5%8F%83%E6%95%B8-2"><span class="post-toc-text"> 幾款經典橫向遊戲的參數</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#super-meat-boy-2"><span class="post-toc-text"> Super Meat Boy</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#super-mario-bro"><span class="post-toc-text"> Super Mario Bro</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#limbo-2"><span class="post-toc-text"> LIMBO</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%95%B8%E5%80%BC%E8%A1%A8%E6%A0%BC-2"><span class="post-toc-text"> 數值表格</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#3-%E5%8F%AF%E6%8E%A7%E5%88%B6%E7%9A%84%E8%B7%B3%E8%BA%8D%E9%AB%98%E5%BA%A6variable-height"><span class="post-toc-text"> 3. 可控制的跳躍高度（Variable Height）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%94%BE%E9%96%8B%E6%99%82%E4%B8%8A%E5%8D%87%E9%80%9F%E5%BA%A6%E7%9B%B4%E6%8E%A5%E6%AD%B8%E9%9B%B6"><span class="post-toc-text"> 放開時，上升速度直接歸零</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%8C%89%E4%BD%8F%E6%99%82%E6%8C%81%E7%BA%8C%E7%B5%A6%E4%BA%88%E5%90%91%E4%B8%8A%E7%9A%84%E5%8A%9B"><span class="post-toc-text"> 按住時，持續給予向上的力</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%94%BE%E9%96%8B%E6%99%82%E7%B5%A6%E4%BA%88%E4%B8%80%E5%80%8B%E5%90%91%E4%B8%8B%E7%9A%84%E5%8A%9Bdown-gravity"><span class="post-toc-text"> 放開時，給予一個向下的力（Down Gravity）</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#4-coyote-time-edge-jump-%E7%9F%AD%E6%99%82%E9%96%93%E5%AE%B9%E8%A8%B1%E9%9B%A2%E5%9C%B0%E5%BE%8C%E8%B7%B3%E8%BA%8D"><span class="post-toc-text"> 4. Coyote Time &#x2F; Edge Jump （短時間容許離地後跳躍）</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#5-%E8%B7%B3%E8%BA%8D%E8%BC%B8%E5%85%A5%E7%B7%A9%E8%A1%9D-jump-buffering-jump-cache"><span class="post-toc-text"> 5. 跳躍輸入緩衝 （Jump Buffering &#x2F; Jump Cache）</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#6-%E8%87%AA%E9%81%A9%E6%87%89-collider-hitbox-pinching-%E9%9A%8E%E6%A2%AF%E8%99%95%E7%90%86"><span class="post-toc-text"> 6. 自適應 Collider &#x2F; Hitbox Pinching &#x2F; 階梯處理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%87%89%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="post-toc-text"> 應用案例</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#7-%E9%82%8A%E7%B7%A3%E5%81%B5%E6%B8%AC%E8%88%87%E8%90%BD%E5%9C%B0%E6%A0%A1%E6%AD%A3"><span class="post-toc-text"> 7. 邊緣偵測與落地校正</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E7%B5%90%E8%AA%9E"><span class="post-toc-text"> 結語</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99%E5%92%8C%E8%A3%9C%E5%85%85"><span class="post-toc-text"> 參考資料和補充</span></a></li></ol>
        </div>   
    </details>
</div>


      <div class="markdown-body">
        <h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p><em>文長注意，建議用電腦版網頁瀏覽，網頁右側有目錄。</em></p>
<p>這是第一篇有關《<a target="_blank" rel="noopener" href="https://store.steampowered.com/app/1928690/Bionic_Bay/">Bionic Bay: 換影循跡</a>》的開發日誌，想了一下還是從最基本的<strong>角色控制</strong>（Character Controller）開始介紹好了。</p>
<p>不過第一篇我還是想先介紹一下優秀 2D 平台跳躍遊戲的角色控制會用到的一些通用知識，主要都是整理自網路上的學習資源和我實際在 Bionic Bay 上的應用。</p>
<blockquote>
<p>這篇文章純討論角色控制、角色物理，<strong>不會包含</strong>「角色動畫」、「攝影機」、「Game Feel」等等其他功能。<br />
另外雖然這篇要講的是 2D 橫向遊戲，實際上這些知識在 3D 角色控制也通用（我實作上也是從 3D 角色控制那邊偷了不少）。</p>
</blockquote>
<h1 id="只是個-2d-遊戲的角色控制是能多複雜"><a class="markdownIt-Anchor" href="#只是個-2d-遊戲的角色控制是能多複雜"></a> 只是個 2D 遊戲的角色控制是能多複雜？</h1>
<p>這邊先放一段 Bionic Bay 角色控制的測試影片：</p>
<div class="video-container"><iframe src="https://www.youtube.com/embed/Igobi3XOqpQ" frameborder="0" loading="lazy" allowfullscreen></iframe></div>
<p>在這個測試場景中只有角色有掛 scripts ，其他所有動態物件都只是 Rigidbody2D 和 Joint2D 的組合。<br />
換句話說，這個角色控制器（Character Controller）並不仰賴場景 Context ，隨時放進去任意場景都至少會有以下功能：</p>
<ul>
<li>能夠順利通過凹凸不平的地形。</li>
<li>都能夠站穩在任何物體上，無論是否會移動（只要速度不要太快）。</li>
<li>只要角度正確就能攀附邊角（Ledge Grab）、牆壁滑行（Wall Slide）、蹬牆跳躍（Wall Jump）。</li>
<li>站在（或是掛在）物體之上時能夠正確地對該物體施力。</li>
<li>離開移動中的物體時保有正確的慣性速度。</li>
<li>當站立的物體速度過快時會被甩出去。</li>
</ul>
<p>為了做到這件事情，看這張圖：</p>
<p><img src="/images/bb-001-character-controller/01.png" alt="" /></p>
<p>這是 Bionic Bay 的<strong>主角物理控制器</strong>的腳本（不含外觀、動畫和 Input 管理）在 Inspector 的樣子。<br />
各個 Module 對應單一功能，有些 Module 雖然實作了不過目前沒用上（沒打勾）。</p>
<p>稍微摘要各個 Module 功能：</p>
<table>
<thead>
<tr>
<th>Module</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Hero Movement</td>
<td>角色移動的核心模組（提供角色速度、旋轉、四方向的接觸狀態、移動函數、碰撞檢測）。</td>
</tr>
<tr>
<td>Horizontal Movement</td>
<td>控制角色水平方向（左右）的速度、加速度。</td>
</tr>
<tr>
<td>Gravity</td>
<td>控制角色承受的重力、垂直方向速度（不使用內建重力）。</td>
</tr>
<tr>
<td>Jump</td>
<td>控制普通跳躍的強度、高度。</td>
</tr>
<tr>
<td>Jump Holding</td>
<td>跳躍後如果未按住跳躍鍵會快速消耗目前上升速度。</td>
</tr>
<tr>
<td>Wall Slide</td>
<td>角色滑行於左右兩側的牆壁的功能。</td>
</tr>
<tr>
<td>Wall Jump</td>
<td>控制牆壁滑行狀態下的跳躍。</td>
</tr>
<tr>
<td>Edge Climber</td>
<td>（未實裝）這是學 Ori 的實作，人物靠近牆壁與地面轉角的時候如果有按住跳躍鍵則會自動上升推進一小段。</td>
</tr>
<tr>
<td>Ground Connector</td>
<td>使角色得以<strong>站立於任何物件之上並隨之移動</strong>的系統，也涉及進入、離開動態地面的慣性運動。</td>
</tr>
<tr>
<td>Ledge Grab</td>
<td>角色可以用手攀附住<strong>符合角度的任意物體邊緣</strong>的系統。</td>
</tr>
<tr>
<td>Ledge Jump</td>
<td>攀附狀態的跳躍。</td>
</tr>
<tr>
<td>Crouch</td>
<td>蹲下功能，包含爬行功能。</td>
</tr>
<tr>
<td>Push</td>
<td>以動態調整的力道<strong>推動任意動態物件</strong>的系統（實際上遊戲沒用到）。</td>
</tr>
<tr>
<td>Slip</td>
<td>在地面上滑行的功能（當站在過於顛頗的地面時觸發）。</td>
</tr>
<tr>
<td>Slip Jump</td>
<td>控制地面滑行的跳躍。</td>
</tr>
<tr>
<td>Body Interpolator</td>
<td>自行實作 Rigidbody.interpolation 的功能（因為一些理由不允許使用內建的）。</td>
</tr>
<tr>
<td>Contact Colliders</td>
<td>儲存當前與角色有碰撞的所有 Collider 列表。</td>
</tr>
<tr>
<td>Dash</td>
<td>角色突進翻滾的功能。</td>
</tr>
<tr>
<td>Dash Holding</td>
<td>（未實裝）若玩家沒有按住按鍵則會縮短翻滾距離的功能。</td>
</tr>
<tr>
<td>Controllable Dash</td>
<td>玩家在翻滾過程中可以<strong>直接透過方向鍵調整突進距離</strong>的功能。</td>
</tr>
<tr>
<td>Capsule Collider Resizer</td>
<td>調整角色 Collider 大小的功能，用於蹲下、移動縮小 Collider。</td>
</tr>
<tr>
<td>Preswap</td>
<td>遊戲中的「標記」（或稱攻擊）動作。</td>
</tr>
<tr>
<td>Ragdoll</td>
<td>就 Ragdoll 功能，之後開一篇來講。</td>
</tr>
<tr>
<td>Roll</td>
<td>這是從 Dash 中再切出來的滾動狀態，主要是供 Bounce ray 等特殊情況下的滾動狀態使用。</td>
</tr>
</tbody>
</table>
<p>我相信有戰鬥系統的動作遊戲會更複雜，Bionic Bay 側重的點只有跑酷體驗所以只針對它強化。<br />
不打算把所有功能都展開來聊，這第一篇文章會先以一個（我認為）最基本的橫向卷軸跳躍遊戲應該要處理好的系統開始介紹 – 也就是「移動」和「跳躍」。</p>
<blockquote>
<p>這些模組、角色物理控制也是從開案初期（2019）直到最近幾個月都還有持續調整的一個系統，非常有可能在我介紹完以後又有功能大幅修改。</p>
</blockquote>
<h1 id="移動與跳躍是能有多複雜"><a class="markdownIt-Anchor" href="#移動與跳躍是能有多複雜"></a> 移動與跳躍？是能有多複雜？</h1>
<p>2D 橫向卷軸 / 平台跳躍遊戲是一個非常容易入門的類型，但非常可惜的是有太多案例是連最基本的這兩件事情都沒做好，不太確定到底是線上的教學參差不齊還是有什麼問題。因為要做好這件事情基本上也不會涉及什麼很難懂的概念或實作，都單純是「如果你沒有做，那只是因為你不知道可以這樣做」的知識而已。</p>
<p>以前一些 know-how 的資源比較分散，不過自從 GMTK 做了這個 <a target="_blank" rel="noopener" href="https://gmtk.itch.io/platformer-toolkit">Platformer Toolkit</a> 之後我都直接推他。</p>
<div class="video-container"><iframe src="https://www.youtube.com/embed/zWi0jgghGcI" frameborder="0" loading="lazy" allowfullscreen></iframe></div>
<p><a target="_blank" rel="noopener" href="https://gmtk.itch.io/platformer-toolkit">https://gmtk.itch.io/platformer-toolkit</a><br />
英文看的懂的話，<strong>強 烈 建 議 去 操 作 一 遍</strong>。<br />
（然後建議下載 Standalone 執行檔，因為 WebGL 的版本閹割了一些東西）</p>
<p>另外推薦一個很少看過有人分享的參考資料：<a target="_blank" rel="noopener" href="http://martinf.dk/jump/">You Say Jump, I Say How High?</a>，是一篇 2015 年發表專門研究 2D 平台跳躍遊戲的跳躍和移動參數的論文，他本身就提及很多 know-how 了，然後嚴謹程度是從「定義參數」、「測量參數的方法」到「測量得出幾款經典遊戲的移動、跳躍參數」，都超爆幹詳細的那種，很值得讀。</p>
<p>接下來我就借用一下這個 Toolkit 和那篇論文來介紹幾個重要知識點。</p>
<h1 id="1-水平移動的速度參數"><a class="markdownIt-Anchor" href="#1-水平移動的速度參數"></a> 1. 水平移動的速度參數</h1>
<p><img src="/images/bb-001-character-controller/platformer_toolkit_1.gif" alt="Platformer Toolkit 的速度設定畫面" /><br />
最基本的東西，讓你的角色左右移動的時候會有比較順滑自然的感受，幾乎每一個橫向卷軸遊戲都會有自己一套參數組。</p>
<p>我常用的參數跟 GMTK 一致，分別有：</p>
<ul>
<li>最高速度（Max Speed）：就可控制的上限速度。</li>
<li>加速度（Acceleration）： 在速度 0 到最高速度之間，方向鍵持續按住的情況下的加速度（每秒提升多少速度）。</li>
<li>減速度（Deceleration）： 在速度 0 到最高速度之間，放開方向鍵時的減速度（每秒降低多少速度）。</li>
<li>轉向加速度（Turn Acceleration 或 Turn Speed）：當目前角色移動方向與輸入方向不同的時候的加速度。</li>
</ul>
<p>然後 GMTK 這裡在空中移動時的水平移動參數是用另一組，分別是 Air Acceleration 、 Air Control 、Air Brake。<br />
這裡我不確定它們實際上的數值意義，我體感大致分別是「空中狀態的加速度」、「空中狀態的轉向加速度」、「空中狀態的減速度」。</p>
<p>但我不知道為什麼他要用三個新名詞，我 Bionic Bay 這邊的做法是「地面上」和「空中」狀態分別都有自己一組同名參數，如下圖。</p>
<p><img src="/images/bb-001-character-controller/horizontal_movement_2.png" alt="Bionic Bay 主角的速度參數（先無視 Extra Max Speed，之後別篇再解釋）" /><br />
上面這組速度參數的效果是要做成：</p>
<ul>
<li>地面上的左右移動反應比較即時（加減速度都相對高），如果只是方向鍵放開的情況會小小滑行，而急著需要轉方向的時候會很快地改變方向。</li>
<li>在空中會比較慣性運動（減速度很低），加速度與地面相同代表你可以做到「先垂直起跳，然後往前移動」的超人動作，轉向速度比減速度高代表你有一定程度改變方向的能力（C 字跳）。</li>
</ul>
<blockquote>
<p>空中的水平移動還有一些變種參數，比如有些遊戲會引入空中摩擦力（Air Friction），讓水平速度降低，形成非對稱跳躍曲線，後面會提到。</p>
</blockquote>
<h2 id="幾款經典橫向遊戲的參數"><a class="markdownIt-Anchor" href="#幾款經典橫向遊戲的參數"></a> 幾款經典橫向遊戲的參數</h2>
<p>這裡引用論文數據，圖中橘線表示按鍵按下去的時間點，綠線代表放開的時間點。</p>
<h3 id="castlevania-惡魔城"><a class="markdownIt-Anchor" href="#castlevania-惡魔城"></a> Castlevania 惡魔城</h3>
<p><img src="/images/bb-001-character-controller/2023-07-23T000611.png" alt="" /><br />
<img src="/images/bb-001-character-controller/horizontal_movement_castle.gif" alt="用 Platformer Toolkit 模擬 Castlevania 效果" /><br />
典型的只有全速和零速度的設計，相當於加速度、減速度都無限大。<br />
早年重戰鬥的動作遊戲都這樣（沒記錯的話洛克人也是），好處是反應速度快，可控性高。</p>
<h3 id="super-meat-boy"><a class="markdownIt-Anchor" href="#super-meat-boy"></a> <a target="_blank" rel="noopener" href="https://store.steampowered.com/app/40800/Super_Meat_Boy/">Super Meat Boy</a></h3>
<p><img src="/images/bb-001-character-controller/2023-07-23T000715.png" alt="" /><br />
<img src="/images/bb-001-character-controller/horizontal_movement_smb.gif" alt="用 Platformer Toolkit 模擬 Super Meat Boy 效果" /><br />
Super Meat Boy 採用低加速度的設計，讓玩家有一個累積速度的過程。<br />
特別的是他的減速度無限大，代表你手一放開就停止了，這個設計怪怪的比較像 bug ，晚點會提。</p>
<h3 id="super-mario-bros-超級瑪利歐兄弟"><a class="markdownIt-Anchor" href="#super-mario-bros-超級瑪利歐兄弟"></a> Super Mario Bros 超級瑪利歐兄弟</h3>
<p><img src="/images/bb-001-character-controller/2023-07-23T000735.png" alt="" /><br />
<img src="/images/bb-001-character-controller/horizontal_movement_mario.gif" alt="用 Platformer Toolkit 模擬 Mario 效果" /><br />
瑪利歐就是典型的低加速低減速的超高慣性運動，會讓人有很滑很飄的控制感。</p>
<h3 id="limbo"><a class="markdownIt-Anchor" href="#limbo"></a> <a target="_blank" rel="noopener" href="https://store.steampowered.com/app/48000/LIMBO/">LIMBO</a></h3>
<p><img src="/images/bb-001-character-controller/2023-07-23T000803.png" alt="" /><br />
<img src="/images/bb-001-character-controller/horizontal_movement_limbo.gif" alt="用 Platformer Toolkit 模擬 LIMBO 效果" /><br />
LIMBO 跟瑪利歐設計一樣是加減速一致，但強度比較高所以更可控一點。<br />
但它的數據比較特別的是最大速度和加速度都會受到輸入的值影響，而且不是線性成長。</p>
<h3 id="轉向加速度turn-acceleration"><a class="markdownIt-Anchor" href="#轉向加速度turn-acceleration"></a> 轉向加速度（Turn Acceleration）</h3>
<p>然後是它們各自的轉向加速度，因為 Castlevania 本來就可以瞬間轉向就不列了。<br />
<img src="/images/bb-001-character-controller/2023-07-23T002243.png" alt="圖片中的橘線表示按下反方向輸入的時間點，綠線表示速度到達 0 的時間點。" /></p>
<p>看到這，有沒有感覺哪裡怪怪的？</p>
<p><strong>Super Meat Boy 的轉向加速度（Turn Acceleration）竟然比它的減速度（Deceleration）還低！</strong></p>
<p>這代表什麼？<br />
「如果你在 Super Meat Boy 中想要緊急改變方向，那你應該直接放開移動鍵，讓角色瞬間停下來，之後再推動方向鍵去讓玩家加速。」</p>
<p>這個設計超級問號的，因為所有玩家想要緊急改變方向的直覺反應都是<strong>直接反向輸入</strong>，但你這樣做反而會滑行更久。所以我偏向認為只是開發者設定錯誤而已，減速度不應該是無限大才對。</p>
<table>
<thead>
<tr>
<th>放開移動輸入</th>
<th>往反方向輸入</th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="/images/bb-001-character-controller/super_meat_boy_1.gif" alt="放開移動輸入" /></td>
<td><img src="/images/bb-001-character-controller/super_meat_boy_2.gif" alt="往反方向輸入" /></td>
</tr>
</tbody>
</table>
<h3 id="數值表格"><a class="markdownIt-Anchor" href="#數值表格"></a> 數值表格</h3>
<p>最後論文有幫我們整理成一張表格，直接看數字比較清楚：<br />
<img src="/images/bb-001-character-controller/2023-07-23T002341.png" alt="各個經典 2D Platformer 的水平速度參數表格" /></p>
<blockquote>
<p>嚴格來說水平速度參數組的選擇沒有對錯，舉這些經典遊戲的例子是希望幫助你了解數值為什麼這樣設計，它們能帶來什麼樣的效果。</p>
</blockquote>
<h1 id="2-跳躍速度-高度與重力gravity"><a class="markdownIt-Anchor" href="#2-跳躍速度-高度與重力gravity"></a> 2. 跳躍速度、高度與重力（Gravity）</h1>
<p><strong>起跳速度</strong>（Takeoff Velocity）和<strong>跳躍高度</strong>算是同一個參數的兩個不同表示形式，因為你已知重力加速度（g）多少就能將兩者直接轉換。<br />
<img src="/images/bb-001-character-controller/jump_var_1.gif" alt="" /><br />
一般建議直接以「跳躍高度」作為參數來設定會比較好，因為它比較直觀，而且也與關卡設計息息相關。</p>
<p>而重力本身更單純，通常就只是個固定 g 值（現實是 9.81 m/s），一直持續施加在角色的垂直速度上。<br />
稍微值得提的是有些遊戲會有所謂 <strong>Terminal Velocity</strong> ，代表<strong>最高的下墜速度</strong>，角色下墜不會比這個速度更快。<br />
<img src="/images/bb-001-character-controller/2023-07-23T004744.png" alt="Mario 和 Braid 就明顯有 Terminal Velocity 存在。" /></p>
<p><em>（Platformer Toolkit 把 Terminal Velocity 參數放在 Assists 類別）</em></p>
<p>而這部分也沒什麼其他參數了，Toolkit 裡面是多附贈了一個 <strong>Down Gravity</strong> 參數，是讓你墜落時所受到的重力加速度比上升中還要大，使得落地時間減少。<br />
<img src="/images/bb-001-character-controller/down_gravity_1.gif" alt="在 Platformer Toolkit 中你可以拉動 Down Gravity 拉桿使得角色墜落更快" /><br />
我自己沒有很喜歡這種重力感就沒實作在 Bionic Bay 上。<br />
例如 <a target="_blank" rel="noopener" href="https://maddythorson.medium.com/celeste-forgiveness-31e4a40399f1">Celeste 就有用這招</a>，不過他的本意是反過來 – 「讓起跳上升期間的重力減半」，而且效果很輕微，因為它本身的 Terminal Velocity 很低（很快就進入等速墜落）所以它用這個的代價也很低。<br />
<img src="https://miro.medium.com/v2/resize:fit:640/1*70K9UUcWBHmvfHFpaY4v1w.gif" alt="" /><br />
<em>圖片出處：<a target="_blank" rel="noopener" href="https://maddythorson.medium.com/celeste-forgiveness-31e4a40399f1">Celeste &amp; Forgiveness</a></em></p>
<blockquote>
<p>雖然直接使用 Down Gravity 的效果我不喜歡，但 Down Gravity 的概念在「可控制的跳躍高度」被發揚光大。</p>
</blockquote>
<h2 id="幾款經典橫向遊戲的參數-2"><a class="markdownIt-Anchor" href="#幾款經典橫向遊戲的參數-2"></a> 幾款經典橫向遊戲的參數</h2>
<h3 id="super-meat-boy-2"><a class="markdownIt-Anchor" href="#super-meat-boy-2"></a> Super Meat Boy</h3>
<p><img src="/images/bb-001-character-controller/2023-07-23T011340.png" alt="" /><br />
這是非常典型的對稱跳躍曲線，沒有多做任何特別參數處理的結果。</p>
<h3 id="super-mario-bro"><a class="markdownIt-Anchor" href="#super-mario-bro"></a> Super Mario Bro</h3>
<p><img src="/images/bb-001-character-controller/2023-07-23T011614.png" alt="瑪利歐的起跳速度與當前水平速度掛勾" /><br />
瑪利歐有個很妙的設計 – 你水平移動速度越快就能跳得越高，就是在鼓勵你全速移動、助跑跳高。</p>
<blockquote>
<p>至於你可能會發現瑪利歐的曲線是<strong>非對稱</strong>的，這代表它也有 Down Gravity 嗎？（在 Platformer Toolkit 的瑪利歐 preset 中是把它當成是有 Down Gravity 的設計）<br />
先說結論，它<strong>並沒有 Down Gravity</strong>。真正的原因是下面會提到的「可控制跳躍高度」設計。</p>
</blockquote>
<h3 id="limbo-2"><a class="markdownIt-Anchor" href="#limbo-2"></a> LIMBO</h3>
<p><img src="/images/bb-001-character-controller/2023-07-23T012508.png" alt="LIMBO 同瑪利歐的設計" /><br />
LIMBO 也承襲了瑪利歐的助跑跳高設計，不過 LIMBO 加速過程也就 0.2 秒，所以單就這個設計的實際差異不大。<br />
也因此有了以下一個新設計：<br />
<img src="/images/bb-001-character-controller/2023-07-23T012835.png" alt="LIMBO 以一個固定距離為基準線，會區分成短跳和長跳" /><br />
基於助跑距離是否有超出一個範圍，會區分成短跳和長跳，短跳的起跳速度較低，進而鼓勵玩家助跑跳躍。</p>
<p>LIMBO 還有個更特別的設計是它的起跳速度（Takeoff Velocity）是有額外的水平向前速度。<br />
<img src="/images/bb-001-character-controller/2023-07-23T013515.png" alt="藍線是假設不包含向前速度的跳躍曲線，紅色是實際加上了向前速度的跳躍曲線" /><br />
雖然幅度不大，但它可以讓你在前跳的時候獲得一定量向前的速度。</p>
<blockquote>
<p>你可能又會發現 LIMBO 的跳躍曲線也是<strong>非對稱</strong>的，這是因為它有空氣摩擦力（Air Friction）設計導致水平移動的速度會被抑制。</p>
</blockquote>
<h3 id="數值表格-2"><a class="markdownIt-Anchor" href="#數值表格-2"></a> 數值表格</h3>
<p><img src="/images/bb-001-character-controller/2023-07-23T015404.png" alt="各個經典 2D Platformer 的起跳速度與重力參數表格" /></p>
<h1 id="3-可控制的跳躍高度variable-height"><a class="markdownIt-Anchor" href="#3-可控制的跳躍高度variable-height"></a> 3. 可控制的跳躍高度（Variable Height）</h1>
<p>又可以稱「動態跳躍高度」的功能，概念是「按住跳躍輸入越久跳越高，按住時間越短跳越低」。<br />
<img src="/images/bb-001-character-controller/variable_jump_1.gif" alt="注意一下圖中的 SPACE 鍵代表跳躍的輸入，按住越久跳得越高，快速放開按鍵就只會小跳" /></p>
<p>不過光這個單一概念就可以有好幾種實作方法，這邊會列出三種做法。</p>
<h2 id="放開時上升速度直接歸零"><a class="markdownIt-Anchor" href="#放開時上升速度直接歸零"></a> 放開時，上升速度直接歸零</h2>
<p>讓按住跳躍鍵的結果等同於原始跳躍高度，但是一放開按鍵就會讓上升速度歸零。<br />
這應該是很常見的做法，因為實作非常簡單，而做出來的效果會非常有立即性（因為放開的瞬間即跳躍的最高點）。<br />
現有案例：Super Meat Boy。<br />
<img src="/images/bb-001-character-controller/2023-07-23T020231.png" alt="Super Meat Boy 採用直接歸零的實作" /><br />
這個做法讓玩家<strong>可控性</strong>最高，缺點是<strong>小跳的跳躍軌跡不自然</strong>，因為放開按鍵的瞬間角色會直接停止並開始墜落，少了「減速過程」。</p>
<blockquote>
<p>GMTK Platformer Toolkit 採用這個實作。</p>
</blockquote>
<h2 id="按住時持續給予向上的力"><a class="markdownIt-Anchor" href="#按住時持續給予向上的力"></a> 按住時，持續給予向上的力</h2>
<p>讓瞬按瞬放的跳躍結果等同於原始設定的跳躍高度，但你如果有按住的話會持續給予一個向上的力（直到消耗完為止）。<br />
這是瑪利歐的做法，這個做法跟上一個做法可以說完全相反，我不確定有沒有其他遊戲也這樣做。<br />
<img src="/images/bb-001-character-controller/2023-07-23T021324.png" alt="瑪利歐採用按住會持續獲得上升力的方式" /><br />
這個做法的玩家可控性稍差一點（因為放開後還要一段時間才到頂端），優點是跳躍曲線比較好看、自然。<br />
但缺點很明顯，<strong>大跳的上升軌跡不太自然</strong>、數值不好設計（因為你設定的起始跳躍高度是小跳高度）。</p>
<h2 id="放開時給予一個向下的力down-gravity"><a class="markdownIt-Anchor" href="#放開時給予一個向下的力down-gravity"></a> 放開時，給予一個向下的力（Down Gravity）</h2>
<p>讓按住跳躍鍵的結果等同於原始跳躍高度，但是一放開按鍵就會被添加一個額外的 Down Gravity 來把原始的起跳速度（Takeoff Velocity）抵銷掉為止。<br />
這算是第一種方法的改良版，可以解決<strong>小跳的不自然感</strong>，缺點是可控性就降低了一點（因為放開後還要一段時間才到頂端）。<br />
現有案例： <a target="_blank" rel="noopener" href="https://store.steampowered.com/app/48000/LIMBO/">LIMBO</a> 、 <a target="_blank" rel="noopener" href="https://store.steampowered.com/app/261570/Ori_and_the_Blind_Forest/">Ori and the Blind Forest</a> 、 <a target="_blank" rel="noopener" href="https://store.steampowered.com/app/1928690/Bionic_Bay/">Bionic Bay</a>。</p>
<p><img src="/images/bb-001-character-controller/2023-07-23T022237.png" alt="我們 Bionic Bay 最終採用這個方案，我自己也覺得這是多數情況的最佳解。" /></p>
<p>實作上要稍微注意的點是，它的目的是「抵銷起跳速度」，並不是單純的讓下降的重力變大，當你的原始起跳速度已經被重力抵銷完了（即按住大跳的情況）就沒必要在加額外的 Down Gravity 了。</p>
<blockquote>
<p>這裡用 Down Gravity 是為了對應文章前面提及的，論文中的用詞是 Release Drag。</p>
</blockquote>
<h1 id="4-coyote-time-edge-jump-短時間容許離地後跳躍"><a class="markdownIt-Anchor" href="#4-coyote-time-edge-jump-短時間容許離地後跳躍"></a> 4. Coyote Time / Edge Jump （短時間容許離地後跳躍）</h1>
<p>這個專有名詞眾說紛紜，也有被稱為 <a target="_blank" rel="noopener" href="http://kpulv.com/123/Platforming_Ledge_Forgiveness/">Platforming Ledge Forgiveness</a>。<br />
因為 Celeste 做太好了所以我就一律用他們使用的名詞 Coyote Time 來稱呼了。<br />
這個「輔助功能」直接看 Celeste 的 GIF 圖就能懂了：<br />
<img src="https://miro.medium.com/v2/resize:fit:640/1*j8PBeydkE6_vaytVHFcZ6Q.gif" alt="人物已經離開地面了才跳躍" /><br />
<em>圖片出處：<a target="_blank" rel="noopener" href="https://maddythorson.medium.com/celeste-forgiveness-31e4a40399f1">Celeste &amp; Forgiveness</a></em></p>
<p>硬要說明的話就是「當角色離地後 N 毫秒內仍可以進行跳躍動作」。</p>
<p>這個實作非常簡單，以 C# 寫個範例碼，假設這是原本的角色跳躍寫法：</p>
<pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">// 每幀更新呼叫此方法</span>
<span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
  <span class="token class-name"><span class="token keyword">bool</span></span> isGrounded <span class="token operator">=</span> <span class="token function">CheckGround</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 檢測角色目前是否站在地面上</span>
  <span class="token class-name"><span class="token keyword">bool</span></span> inputJump <span class="token operator">=</span> <span class="token function">GetInputJump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 是否按下跳躍鍵</span>

  <span class="token comment">// 如果在地面上並且按下跳躍鍵，即可執行跳躍</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isGrounded <span class="token operator">&amp;&amp;</span> inputJump<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">Jump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>把<strong>可跳躍判定</strong>從 <code>isGrounded</code> 換成 <code>coyoteTime &gt; 0</code> 就好，如下：</p>
<pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">float</span></span> TOLERANCE <span class="token operator">=</span> <span class="token number">0.05f</span><span class="token punctuation">;</span> <span class="token comment">// 離地後有 0.05 秒的時間容許跳躍</span>
<span class="token class-name"><span class="token keyword">float</span></span> m_CoyoteTime<span class="token punctuation">;</span> <span class="token comment">// coyote time 的剩餘時間</span>

<span class="token comment">// 每幀更新呼叫此方法</span>
<span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
  <span class="token class-name"><span class="token keyword">bool</span></span> isGrounded <span class="token operator">=</span> <span class="token function">CheckGround</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 檢測角色目前是否站在地面上</span>
  <span class="token class-name"><span class="token keyword">bool</span></span> inputJump <span class="token operator">=</span> <span class="token function">GetInputJump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 是否按下跳躍鍵</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isGrounded<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    m_CoyoteTime <span class="token operator">=</span> TOLERANCE<span class="token punctuation">;</span> <span class="token comment">// 站在地面上就設定 coyote time</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    m_CoyoteTime <span class="token operator">-=</span> Time<span class="token punctuation">.</span>deltaTime<span class="token punctuation">;</span> <span class="token comment">// 如果沒有站在地面上就開始倒數</span>
  <span class="token punctuation">&#125;</span>

  <span class="token comment">// 如果 coyote time 還沒倒數至 0 並且按下跳躍鍵，即可執行跳躍</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>m_CoyoteTime <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> inputJump<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">Jump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>我認為這真的是一個實作超級簡單，效果又超棒的功能。很多遊戲只要加入這個，平台之間的跳躍體驗就大幅上升。<br />
<s>對我就是在說 Metroid Dread</s></p>
</blockquote>
<h1 id="5-跳躍輸入緩衝-jump-buffering-jump-cache"><a class="markdownIt-Anchor" href="#5-跳躍輸入緩衝-jump-buffering-jump-cache"></a> 5. 跳躍輸入緩衝 （Jump Buffering / Jump Cache）</h1>
<p>為你的<strong>跳躍輸入按鍵</strong>加入緩衝（buffer），就是<br />
「輸入跳躍按鍵的當下若還無法觸發跳躍，在之後的 N 秒內只要有進入可跳躍的狀態，仍會自動觸發跳躍」<br />
整句很繞口，看下面 GIF 圖比較好理解。<br />
這是在 Bionic Bay 實作的效果，情境是在角色快落地的時候再次按下跳躍鍵（圖中的 SPACE 亮起代表按下）。</p>
<table>
<thead>
<tr>
<th>開啟輸入緩衝</th>
<th>關閉</th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="/images/bb-001-character-controller/jump_buffering_1.gif" alt="能夠成功跳起來" /></td>
<td><img src="/images/bb-001-character-controller/jump_buffering_2.gif" alt="跳不起來" /></td>
</tr>
</tbody>
</table>
<p><em>我從來沒想過為了遊戲教學寫的 Replay 系統可以在寫文章用上</em></p>
<p>因為當玩家<strong>預期要在角色落地的瞬間馬上再跳起來</strong>的話，通常都會<strong>早按</strong>。如果你沒有做這個輸入緩衝的話會導致角色跳不起來，玩家就會怪罪遊戲說「我明明就按了啊」。</p>
<blockquote>
<p>輸入緩衝真的超重要，而且不只跳躍輸入要緩衝，任何有這種需要抓準時機按下的按鍵都要有一定的緩衝時間（e.g. 攻擊、迴避、招架），否則玩家會一直怪罪遊戲設計不良。</p>
</blockquote>
<h1 id="6-自適應-collider-hitbox-pinching-階梯處理"><a class="markdownIt-Anchor" href="#6-自適應-collider-hitbox-pinching-階梯處理"></a> 6. 自適應 Collider / Hitbox Pinching / 階梯處理</h1>
<p><em>從這裡開始 GMTK Platformer Toolkit 就沒有實作了。</em></p>
<p>這裡引用 <a target="_blank" rel="noopener" href="https://store.steampowered.com/app/792710/Levelhead_Platformer_Maker/">LevelHead</a> 開發者在 GDC 2020 分享的 <a target="_blank" rel="noopener" href="https://youtu.be/HCnZhs-92j0?t=1108">Forgiveness Mechanics: Reading Minds for Responsive Gameplay</a> 來介紹這個輔助功能。</p>
<p>要解決的情境如下圖：<br />
<img src="/images/bb-001-character-controller/2023-07-23T120748.png" alt="人物是橘色方塊要往右走，但前方有突起物" /><br />
角色的前方有一個小突起物（階梯）擋住你的移動路徑，什麼都沒處理的話往前移動會被它卡住。</p>
<p>有一個 Naive 解是 – 「把你的角色 Collider 換成圓角形狀（Round）」，比如說 Circle Collider 或 Capsule Collider ，這樣一來即便你直接撞上去也 <em>有機會</em> 讓物理引擎幫你解決。但這個方法的效果不夠穩定實用，而且弄不好甚至有機會在撞上去的瞬間讓你的人直接起飛。</p>
<p>而這篇要介紹的穩定實用方法是「當你移動的時候縮小碰撞範圍（Hitbox）」。<br />
如下圖把碰撞範圍縮小至黃色區域：<br />
<img src="/images/bb-001-character-controller/2023-07-23T120844.png" alt="縮小人物碰撞範圍（高度）藉以通過突起物" /></p>
<p>但是這並不是單純讓角色的 Collider 變矮然後就往下墜落，重點是「角色的碰撞範圍縮小後，依然保持與地面相同的距離」。<br />
所以當角色成功站上突起物之後，也要讓它與新的地面高度保持原本的距離，也就是往上升。<br />
可以直接看這個三步驟 GIF 示意圖：<br />
<img src="/images/bb-001-character-controller/hitbox_pinch_1.gif" alt="踩上突起地面後要校正成原始的離地高度，後面兩步實際上是一次做完的" /></p>
<h2 id="應用案例"><a class="markdownIt-Anchor" href="#應用案例"></a> 應用案例</h2>
<p>一樣先用 LevelHead 提供的例子</p>
<table>
<thead>
<tr>
<th>沒有使用 Hitbox Pinching</th>
<th>使用 Hitbox Pinching</th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="/images/bb-001-character-controller/hitbox_pinch_2.gif" alt="" /></td>
<td><img src="/images/bb-001-character-controller/hitbox_pinch_3.gif" alt="" /></td>
</tr>
</tbody>
</table>
<p>再來其實<strong>並不是只有水平移動可以用這招，垂直跳躍也能用</strong>。<br />
<img src="/images/bb-001-character-controller/hitbox_pinch_4.gif" alt="縮小 Hitbox 的軸向從原本的縮高度換成縮寬度，可以減少撞到頭的情況" /></p>
<p>而 <a target="_blank" rel="noopener" href="https://store.steampowered.com/app/504230/Celeste/">Celeste</a> 也有大量使用這招：<br />
<img src="https://miro.medium.com/v2/resize:fit:640/1*g5DWQoaPgADy2YJSadME9Q.gif" alt="" /><br />
<img src="https://miro.medium.com/v2/resize:fit:640/1*wd8jSIbd7BCaltCWhOIxcw.gif" alt="" /><br />
<img src="https://miro.medium.com/v2/resize:fit:640/1*cCX7zCuPXb7KFSpZXIy7VA.gif" alt="" /><br />
<em>圖片出處：<a target="_blank" rel="noopener" href="https://maddythorson.medium.com/celeste-forgiveness-31e4a40399f1">Celeste &amp; Forgiveness</a></em></p>
<p>最後是在 Bionic Bay 的應用：<br />
<img src="/images/bb-001-character-controller/hitbox_pinch_5.gif" alt="克服階梯問題" /></p>
<p>實際上關卡中不會刻意設計這種階梯，但這個功能可以大幅度地降低角色被場景各種縫隙、突起給卡住的情況</p>
<table>
<thead>
<tr>
<th><img src="/images/bb-001-character-controller/hitbox_pinch_6.gif" alt="走在畸形物體表面上1" /></th>
<th><img src="/images/bb-001-character-controller/hitbox_pinch_7.gif" alt="走在畸形物體表面上2" /></th>
</tr>
</thead>
<tbody></tbody>
</table>
<blockquote>
<p>這個功能的實作依據角色移動的具體方法和地圖設計的不同而有不同的實作形式。</p>
<ul>
<li>比較傳統 Retro 類型的平台跳躍因為通常是 Tile-based 的地圖設計和更精準的角色控制方法（移動方式是基於程式碼直接對 position 進行控制），只考慮可操控角色本身的話會比較簡單實作。</li>
<li>Bionic Bay 因為是物理驅動（移動方式是設定 velocity 之後再交由物理引擎去跑）加上地形非常混亂不規則，採取的實作方式更接近通用 3D Character Controller 的形式，坑很多，實作有參考這兩個 Unity Assets：<a target="_blank" rel="noopener" href="https://assetstore.unity.com/packages/tools/physics/kinematic-character-controller-99131">Kinematic Character Controller</a>、<a target="_blank" rel="noopener" href="https://assetstore.unity.com/packages/tools/physics/character-controller-pro-159150">Character Controller Pro</a>，之後的文章會再補上具體是怎麼做的。</li>
</ul>
</blockquote>
<h1 id="7-邊緣偵測與落地校正"><a class="markdownIt-Anchor" href="#7-邊緣偵測與落地校正"></a> 7. 邊緣偵測與落地校正</h1>
<p>這邊引用 <a target="_blank" rel="noopener" href="https://store.steampowered.com/app/588650/Dead_Cells/">Dead Cells</a> 在 TGDF 2018 的演講 <a target="_blank" rel="noopener" href="https://youtu.be/bu-RbmjvltU?t=1019">使玩家感覺良好 – 《Dead Cells》開發回顧</a> 的影片片段 – 「跳躍於平台之間」。</p>
<p>他們實作了所謂的「Cheating on arrival」，意思是「當角色在降落於「靠近平台邊緣」的時候，會自動校正落地點於平台之上」。<br />
直接看比較圖：</p>
<table>
<thead>
<tr>
<th>Cheating on arrival</th>
<th>None</th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="/images/bb-001-character-controller/ledge_tolerance_1.gif" alt="" /></td>
<td><img src="/images/bb-001-character-controller/ledge_tolerance_2.gif" alt="" /></td>
</tr>
</tbody>
</table>
<p>這個概念是因為以玩家視角不會諒解所謂的「啊就剛好你的 Collider 就只差了一點點才能踩到地板，所以摔下去了」。<br />
邏輯跟前面輸入緩衝（Buffering）的概念差不多，玩家的預期心理與實際上物理結果並不是一致的。</p>
<p>不過我們取其精神即可，實作上不一定要學 Dead Cells 的<strong>落地校正</strong>。</p>
<p>以我們 Bionic Bay 來說，邊角攀附（Ledge Grab）機制就能做到一樣的效果。<br />
<img src="/images/bb-001-character-controller/ledge_tolerance_3.gif" alt="" /></p>
<p>慢動作看：<br />
<img src="/images/bb-001-character-controller/ledge_tolerance_4.gif" alt="綠色框框是抓取判定範圍，注意看人原本看起來已經掉下去了，但判定夠大可以抓回去" /></p>
<h1 id="結語"><a class="markdownIt-Anchor" href="#結語"></a> 結語</h1>
<p>我個人認為比較<strong>通用</strong>的「移動」和「跳躍」的知識點都寫在這了。</p>
<p>實務上還會依據個別遊戲的不同去強化輔助不同的功能，不過核心理念都一樣，就是<br />
「不要讓玩家被非刻意設計的小瑕疵卡住，讓玩家把時間花在開發者刻意設計的挑戰才是最重要的事」。</p>
<blockquote>
<p>但也不是說把以上知識全部做到就能讓所有玩家滿意，實際上也是有玩家覺得 <a target="_blank" rel="noopener" href="https://store.steampowered.com/app/1928690/Bionic_Bay/">《Bionic Bay: 換影循跡》</a> 的操作很滑很爛，這裡就直接引用我朋友說的：<br />
「往好處想就是沒寫這堆功能就更爛」。<br />
舉例來說光<strong>速度參數</strong>和<strong>跳躍曲線</strong>的選擇就一定會分好幾派了，你不可能滿足所有人。<s>除非你做一個可以自由調整參數的遊戲</s></p>
</blockquote>
<h1 id="參考資料和補充"><a class="markdownIt-Anchor" href="#參考資料和補充"></a> 參考資料和補充</h1>
<p>礙於篇幅，我只整理了我覺得重要的知識點，有空的話可以直接看參考資料本身，他們都講得非常詳盡，一定對開發有幫助。</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://martinf.dk/jump/">You Say Jump, I Say How High?</a></li>
<li><a target="_blank" rel="noopener" href="https://gmtk.itch.io/platformer-toolkit">GMTK Platformer Toolkit</a></li>
<li>Celeste 系列
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/NoelFB/Celeste">Source Code</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=yorTG9at90g">Why Does Celeste Feel So Good to Play?</a></li>
<li><a target="_blank" rel="noopener" href="https://maddythorson.medium.com/celeste-forgiveness-31e4a40399f1">Celeste &amp; Forgiveness</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=HCnZhs-92j0">Forgiveness Mechanics: Reading Minds for Responsive Gameplay</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=bu-RbmjvltU">使玩家感覺良好 – 《Dead Cells》開發回顧</a></li>
<li><a target="_blank" rel="noopener" href="https://assetstore.unity.com/packages/tools/physics/kinematic-character-controller-99131">Kinematic Character Controller (Asset Store)</a></li>
</ul>
<p>雖然文章內沒有引用，但我覺得還是值得一看的資料：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://forums.tigsource.com/index.php?topic=46289.1040">Leilani’s Island Devlog</a></li>
<li><a target="_blank" rel="noopener" href="https://home.gamer.com.tw/artwork.php?sn=5125027">遊戲開發日誌 #8 系統移轉、Coyote Time、轉角補正 etc.</a> &lt;— 寫這篇的時候翻到一個有為青年的獨立開發日誌，幫推</li>
<li><a target="_blank" rel="noopener" href="http://higherorderfun.com/blog/2012/05/20/the-guide-to-implementing-2d-platformers/">The guide to implementing 2D platformers</a></li>
<li><a target="_blank" rel="noopener" href="https://catlikecoding.com/unity/tutorials/movement/">Unity Movement Tutorials - Catlike Coding</a></li>
</ul>
<hr />
<p>下一篇開發日誌預計會寫更特定主題、特定遊戲才適用的功能實作。</p>
<!-- flag of hidden posts -->
      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime" title="Update time"></i>
              2023-07-22 17:54:57
            </span>
            
                  <span class="post-tags">
                    <i class="iconfont icon-tags" title="Tags"></i>
                    
                    <span class="span--tag">
                      <a href="/tags/Bionic-Bay/" title="Bionic Bay">
                        <b>#</b> Bionic Bay
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/Gamedev/" title="Gamedev">
                        <b>#</b> Gamedev
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/Unity/" title="Unity">
                        <b>#</b> Unity
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/Physics/" title="Physics">
                        <b>#</b> Physics
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/BB-devlog/" title="BB-devlog">
                        <b>#</b> BB-devlog
                      </a>
                    </span>
                    
                  </span>
              
          </div>
          <div class="post-foot-prev">
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">Contents</div>
    <div class="catalog-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text"> 前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%AA%E6%98%AF%E5%80%8B-2d-%E9%81%8A%E6%88%B2%E7%9A%84%E8%A7%92%E8%89%B2%E6%8E%A7%E5%88%B6%E6%98%AF%E8%83%BD%E5%A4%9A%E8%A4%87%E9%9B%9C"><span class="toc-text"> 只是個 2D 遊戲的角色控制是能多複雜？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A7%BB%E5%8B%95%E8%88%87%E8%B7%B3%E8%BA%8D%E6%98%AF%E8%83%BD%E6%9C%89%E5%A4%9A%E8%A4%87%E9%9B%9C"><span class="toc-text"> 移動與跳躍？是能有多複雜？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E6%B0%B4%E5%B9%B3%E7%A7%BB%E5%8B%95%E7%9A%84%E9%80%9F%E5%BA%A6%E5%8F%83%E6%95%B8"><span class="toc-text"> 1. 水平移動的速度參數</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B9%BE%E6%AC%BE%E7%B6%93%E5%85%B8%E6%A9%AB%E5%90%91%E9%81%8A%E6%88%B2%E7%9A%84%E5%8F%83%E6%95%B8"><span class="toc-text"> 幾款經典橫向遊戲的參數</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#castlevania-%E6%83%A1%E9%AD%94%E5%9F%8E"><span class="toc-text"> Castlevania 惡魔城</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#super-meat-boy"><span class="toc-text"> Super Meat Boy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#super-mario-bros-%E8%B6%85%E7%B4%9A%E7%91%AA%E5%88%A9%E6%AD%90%E5%85%84%E5%BC%9F"><span class="toc-text"> Super Mario Bros 超級瑪利歐兄弟</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#limbo"><span class="toc-text"> LIMBO</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%89%E5%90%91%E5%8A%A0%E9%80%9F%E5%BA%A6turn-acceleration"><span class="toc-text"> 轉向加速度（Turn Acceleration）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B8%E5%80%BC%E8%A1%A8%E6%A0%BC"><span class="toc-text"> 數值表格</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E8%B7%B3%E8%BA%8D%E9%80%9F%E5%BA%A6-%E9%AB%98%E5%BA%A6%E8%88%87%E9%87%8D%E5%8A%9Bgravity"><span class="toc-text"> 2. 跳躍速度、高度與重力（Gravity）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B9%BE%E6%AC%BE%E7%B6%93%E5%85%B8%E6%A9%AB%E5%90%91%E9%81%8A%E6%88%B2%E7%9A%84%E5%8F%83%E6%95%B8-2"><span class="toc-text"> 幾款經典橫向遊戲的參數</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#super-meat-boy-2"><span class="toc-text"> Super Meat Boy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#super-mario-bro"><span class="toc-text"> Super Mario Bro</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#limbo-2"><span class="toc-text"> LIMBO</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B8%E5%80%BC%E8%A1%A8%E6%A0%BC-2"><span class="toc-text"> 數值表格</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E5%8F%AF%E6%8E%A7%E5%88%B6%E7%9A%84%E8%B7%B3%E8%BA%8D%E9%AB%98%E5%BA%A6variable-height"><span class="toc-text"> 3. 可控制的跳躍高度（Variable Height）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%BE%E9%96%8B%E6%99%82%E4%B8%8A%E5%8D%87%E9%80%9F%E5%BA%A6%E7%9B%B4%E6%8E%A5%E6%AD%B8%E9%9B%B6"><span class="toc-text"> 放開時，上升速度直接歸零</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%89%E4%BD%8F%E6%99%82%E6%8C%81%E7%BA%8C%E7%B5%A6%E4%BA%88%E5%90%91%E4%B8%8A%E7%9A%84%E5%8A%9B"><span class="toc-text"> 按住時，持續給予向上的力</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%BE%E9%96%8B%E6%99%82%E7%B5%A6%E4%BA%88%E4%B8%80%E5%80%8B%E5%90%91%E4%B8%8B%E7%9A%84%E5%8A%9Bdown-gravity"><span class="toc-text"> 放開時，給予一個向下的力（Down Gravity）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-coyote-time-edge-jump-%E7%9F%AD%E6%99%82%E9%96%93%E5%AE%B9%E8%A8%B1%E9%9B%A2%E5%9C%B0%E5%BE%8C%E8%B7%B3%E8%BA%8D"><span class="toc-text"> 4. Coyote Time &#x2F; Edge Jump （短時間容許離地後跳躍）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E8%B7%B3%E8%BA%8D%E8%BC%B8%E5%85%A5%E7%B7%A9%E8%A1%9D-jump-buffering-jump-cache"><span class="toc-text"> 5. 跳躍輸入緩衝 （Jump Buffering &#x2F; Jump Cache）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E8%87%AA%E9%81%A9%E6%87%89-collider-hitbox-pinching-%E9%9A%8E%E6%A2%AF%E8%99%95%E7%90%86"><span class="toc-text"> 6. 自適應 Collider &#x2F; Hitbox Pinching &#x2F; 階梯處理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%87%89%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="toc-text"> 應用案例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E9%82%8A%E7%B7%A3%E5%81%B5%E6%B8%AC%E8%88%87%E8%90%BD%E5%9C%B0%E6%A0%A1%E6%AD%A3"><span class="toc-text"> 7. 邊緣偵測與落地校正</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B5%90%E8%AA%9E"><span class="toc-text"> 結語</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99%E5%92%8C%E8%A3%9C%E5%85%85"><span class="toc-text"> 參考資料和補充</span></a></li></ol>
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        


  <div id="disqus_thread"></div>
  <script>

  /**
  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
  /*
  var disqus_config = function () {
  this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
  this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
  };
  */
  (function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = 'https://pedevmakesgame.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






      </div>
    
  </div>
  



        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          <a title="github" target="_blank" rel="noopener" href="https://github.com/qwe321qwe321qwe321">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
        <li>
          <a title="twitter" target="_blank" rel="noopener" href="https://twitter.com/PeDev_">
            <i class="iconfont icon-twitter"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/qwe321qwe321qwe321">Copyright © 2023 PeDev</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
</div>
<script src="/js/prism/prism.js" async></script>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="Search...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>First search, index file loading, please wait...<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>No result<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The search.xml file was not found, please refer to：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The request failed, Try to refresh the page or try again later.<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        
  
    <div class="share-icon tools-bar-item">
      <a href="javascript: void(0)" id="share-icon">
        <i class="iconfont iconshare"></i>
      </a>
      <div class="share-content hidden">
        
          <a class="share-item" href="https://twitter.com/intent/tweet?text=%E5%81%9A%E5%A5%BD%202D%20%E5%B9%B3%E5%8F%B0%E8%B7%B3%E8%BA%8D%E9%81%8A%E6%88%B2%EF%BC%8C%E5%BE%9E%E8%A7%92%E8%89%B2%E6%8E%A7%E5%88%B6%E9%96%8B%E5%A7%8B%20_BB001&url=https%3A%2F%2Fqwe321qwe321qwe321.github.io%2Fposts%2F61013%2F" target="_blank" title="Twitter">
            <i class="iconfont icon-twitter"></i>
          </a>
        
        
          <a class="share-item" href="https://www.facebook.com/sharer.php?u=https://qwe321qwe321qwe321.github.io/posts/61013/" target="_blank" title="Facebook">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        
      </div>
    </div>
  
  
<script src="/js/shares.js"></script>



      </div>
    </div>
  </body>
</html>
